# Monitor Extracts and Replicats

## Introduction

This lab walks you through the steps to verify and monitor the Extract and Replicat processes created and run in this workshop, and how to maintain the trail files generated by these processes.

Estimated time: 10 minutes

### About Performance Monitoring

Monitoring the performance of your GoldenGate instance ensures that your data replication processes are running smoothly and efficiently. You can monitor performance in both the Oracle Cloud Infrastructure (OCI) GoldenGate Deployment Console as well as in the Oracle Cloud Console on the Deployment Details page.

### Objectives

In this lab, you will:
* Perform inserts to the source database
* View charts and statistics using the Performance Metrics Server in the GoldenGate deployment console
* Use Metrics on the Deployment Details page in the Oracle Cloud Console to determine overall instance health and utilization
* Create and run a Purge task

### Prerequisites

In order to complete this lab, you should have completed the preceding labs.

## Task 1: Perform inserts to the source database

1.  Return to the Oracle Cloud console and use the navigation menu (hamburger icon) to navigate back to **Databases**, **DB Systems**, and then **SourceMySQL**.

2.  On the SourceMySQL details page, copy the **Private IP Address**.

3.  Open the Oracle Cloud console navigation menu and navigate to **Identity & Security**, and then click **Bastion**.

5.  On the **Bastions** page, select your Bastion to view its details.

6.  Under **Sessions**, click **Create session**.

    >**NOTE:** If you already have a session running for your SourceMySQL DB system, you can skip to step 14.

7.  In the Create session panel, select **SSH port forwarding session** from the session type dropdown.

8.  For **IP address**, paste the Private IP Address you copied from the SourceMySQL details page.

9.  For **Port**, change the value to `3306`.

10. For SSH key, you can either upload an existing SSH public key, or generate a new SSH key pair.

11. Click **Create session**.

12. After the session is Active, select Copy SSH command from the Action (ellipsis icon) menu.

13. Open Cloud Shell.

14. After the cloud shell session is active, paste the SSH command from your bastion session. Ensure that you replace the `<privateKey` and `<localPort>` values.

    >**NOTE:** If you generated a new SSH key pair in step 10, you must first upload your private key to Cloud Shell using the Cloud Shell Settings menu, and change the permission on the key (`chmod 600 <privateKey>`).

15. Enter the following command to start MySQL Shell.

    >**NOTE:** If using a Bastion session, replace localhost with the private IP of the MySQL database.

    ```
    <copy>mysqlsh admin@localhost:3306 --sql</copy>
    ```

4.  Enter the following inserts:

    ```
    <copy>use SRC_OCIGGLL;
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1000,'Houston',20,743113);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1001,'Dallas',20,822416);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1002,'San Francisco',21,157574);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1003,'Los Angeles',21,743878);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1004,'San Diego',21,840689);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1005,'Chicago',23,616472);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1006,'Memphis',23,580075);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1007,'New York City',22,124434);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1008,'Boston',22,275581);
Insert into SRC_OCIGGLL.SRC_CITY (CITY_ID,CITY,REGION_ID,POPULATION) values (1009,'Washington D.C.',22,688002);
commit;</copy>
    ```

5.  In the MySQLDeployment console, click the **Extract name (CDCEXT)**, and then click **Statistics**. Verify that **SRC\_OCIGGLL.SRC\_CITY** is listed with 10 inserts.

    ![Extract Process Information - Statistics](https://oracle-livelabs.github.io/goldengate/ggs-common/monitor/images/04-17-ext-stats.png " ")

6.  Go back to the Overview screen, click the **Replicat name (RCDC)**, and then click **Statistics**. Verify that **SRC\_OCIGGLL.SRC\_CITY** is listed with 10 inserts.

    ![Replicat Process Information - Statistics](https://oracle-livelabs.github.io/goldengate/ggs-common/monitor/images/01-06-rep-statistics.png " ")

7.  In the Oracle Cloud console, open Database actions from the TargetADW Database details page. 

8.  On the Database actions page, select **SQL**.

9.  In the Navigator panel, from the Schema dropdown, select **SRCMIRROR_OCIGGLL**.

10. In the list of tables, right-click **SRC_CITY** and then select **Open**.

11. In the SRCMIRROR_OCIGGLL.SRC_CITY view, click **Data**, and then verify that the 10 new entries inserted in Step 4 appear.

## Task 2: Using the Performance Metrics Server

1.  In the MySQLDeployment console, click **Performance Metrics Server**, and then click **CDCEXT**.

    ![Performance Metrics Service page - EXT highlighted](https://oracle-livelabs.github.io/goldengate/ggs-common/monitor/images/05-01-perf-serv.png)

    > **Note:** You can also view performance details for the Administration, Distribution, and Receiver Servers, as well as any processes created.

2.  Click **Database Statistics**.

    ![Database Statistics page](https://oracle-livelabs.github.io/goldengate/ggs-common/monitor/images/05-03-db-stats.png)

    Here, you can view the real time database statistics, such as Inserts, Updates, Deletes, and so on.

4.  Repeat steps 1-3 in ADWDeployment to view a snapshot of the Replicat's (named **Rep** in our lab) Database Statistics.

## Task 3: Viewing GoldenGate metrics in the Oracle Cloud console

1.  In the Oracle Cloud console navigation menu, select **Observability & Management**, then under **Monitoring**, select **Metrics Explorer**.

2.  On the Metrics Explorer page, in the **Query** section, set the following parameters, and then click **Update Chart**.

    * Compartment: Select your compartment
    * Metric namespace: Select **oci_goldengate**
    * Metric name: Select **ExtractLag**
    * Dimension name: Select **deploymentName**
    * Dimension value: Select **MySQLDeployment**

    ![Metrics query for MySQLDeployment](./images/03-02-query1.png " ")

3.  Click **Add Query**, set the following parameters, and then click **Update Chart**.

    * Compartment: Select your compartment
    * Metric namespace: Select **oci_goldengate**
    * Metric name: Select **ReplicatLag**
    * Dimension name: Select **deploymentName**
    * Dimension value: Select **ADWDeployment**

    ![Metrics query for ADWDeployment](./images/03-03-query2.png " ")

4.  Refresh your view after 5 minutes to see updated metrics.

In this lab, you learned to monitor performance in the OCI GoldenGate deployment console and in the Oracle Cloud console.

## Task 4: Create a Purge task

1.  In the MySQLDeployment console, open the navigation menu (hamburger icon), and then click **Configuration**.

    ![OCI GoldenGate Deployment Console navigation menu](https://oracle-livelabs.github.io/goldengate/ggs-common/purge/images/01-01-navmenu.png " ")

2.  On the **Configuration** screen, click **Tasks**, and then click **Add Purge Trail Task** (plus icon). The **Create a new Purge Trials task** form appears.

    ![Create a new Purge Trails task on Tasks page](https://oracle-livelabs.github.io/goldengate/ggs-common/purge/images/01-02-addtask.png " ")

3.  For **Operation Name**, enter a name.

4.  For **Trail**, enter the name of a Trail file, and then click **Add** (plus icon). For example, in this workshop, our Extract Trail file is called `E1`.

    ![Trail field highlighted](https://oracle-livelabs.github.io/goldengate/ggs-common/purge/images/01-04-addtrail.png " ")

5.  For **Keep Rule**, select **Number of Files**, and then enter `1`. This indicates that one Trail file will be kept, while all others are purged.

6.  For **Purge Frequency**, select **Hours**, and then enter `1`. This indicates that this Purge task will run every hour.

    ![Keep Rule and Purge Frequency fields highlighted](https://oracle-livelabs.github.io/goldengate/ggs-common/purge/images/01-06-rules.png " ")

7.  Click **Submit**.

**Proceed to the next lab.**

## Learn more

* [Manage Trail files](https://docs.oracle.com/en/cloud/paas/goldengate-service/ntzlj/index.html)
* [Monitor performance in the Oracle Cloud console](https://docs.oracle.com/en/cloud/paas/goldengate-service/vddvk/index.html)
* [Monitor performance in the deployment console](https://docs.oracle.com/en/cloud/paas/goldengate-service/alllr/index.html)

## Acknowledgements
* **Author** - Jenny Chan, Consulting User Assistance Developer, Database User Assistance
* **Contributors** -  Julien Testut, Database Product Management
* **Last Updated By/Date** - Jenny Chan, September 2023
